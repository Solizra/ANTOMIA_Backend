name: Import Substack Feed (HTTP)

on:
  schedule:
    # Ejecutar cada 14 d√≠as a las 2:00 AM UTC
    - cron: '0 2 */14 * *'
  workflow_dispatch: # Permitir ejecuci√≥n manual

jobs:
  import-substack-http:
    runs-on: ubuntu-latest
    
    steps:
    - name: Import Substack Feed via HTTP
      run: |
        echo "üöÄ Iniciando importaci√≥n de feed Substack via HTTP..."
        
        # Hacer petici√≥n al endpoint del servidor
        response=$(curl -s -X POST "https://antomia-backend.onrender.com/api/newsletters/import-substack-now" \
          -H "Content-Type: application/json" \
          -w "HTTPSTATUS:%{http_code}")
        
        # Extraer c√≥digo de estado HTTP
        http_code=$(echo $response | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
        body=$(echo $response | sed -e 's/HTTPSTATUS:.*//g')
        
        echo "üìä Respuesta del servidor:"
        echo "$body"
        
        if [ $http_code -eq 200 ]; then
          echo "‚úÖ Importaci√≥n de Substack completada exitosamente"
        else
          echo "‚ùå Error en la importaci√≥n de Substack (HTTP $http_code)"
          exit 1
        fi
        
    - name: Notify completion
      if: always()
      run: |
        echo "üèÅ Workflow de importaci√≥n de Substack finalizado"
